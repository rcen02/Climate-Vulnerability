# -*- coding: utf-8 -*-
"""
Created on Wed May 10 18:22:10 2023

@author: Rudy
"""

import pandas as pd

raw_data = pd.read_csv('CountyData.csv',dtype={"FIPS_Combined":str,"Year4":str})

#Selecting county expenditure data for 2020
year_2020 = raw_data[raw_data['Year4']=='2020'].copy()

#Filtering down data to only id, population, and total expenditure
keep = ['Name','FIPS_Combined','Population','Total_Expenditure']
filtered = year_2020[keep].copy()

#Calculating per capita total expenditure
filtered['Per_capita_exp'] = filtered['Total_Expenditure']/filtered['Population']*1000

#Calculating the percentile rank for each county's per capita expenditure
#Categorizing each quintile under 5 "expenditure levels", 1 being the lowest quintile and 5 being the highest
filtered['exp_percentile'] = filtered['Per_capita_exp'].rank(pct=True)
filtered['expenditure_level'] = pd.qcut(filtered['Per_capita_exp'],5,labels=[1,2,3,4,5])

#Creating csv file for expenditure data
filtered.to_csv('expenditures.csv')