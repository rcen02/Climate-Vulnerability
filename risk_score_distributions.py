# -*- coding: utf-8 -*-
"""
Created on Wed May 10 18:18:54 2023

@author: Rudy
"""

import matplotlib.pyplot as plt
import fsf_renaming as fsf
import risk as rk

#Using the fsf_renaming script as a module to read risk county data in with clean column names

flood = fsf.read('flood')
fire = fsf.read('fire')
heat = fsf.read('heat')
wind = fsf.read('wind')

#Using cleaning script as a module to create risk % columns using an initial cutoff score of 1

flood = rk.risk_calc(flood,'1')
fire = rk.risk_calc(fire,'1')
heat = rk.risk_calc(heat,'1')
wind = rk.risk_calc(wind,'1')

all_risks = [(flood,'Flood'),(fire,'fire'),(heat,'heat'),(wind,'wind')]

scores = ["2","3","4","5","6","7","8","9","10"]

#Creating a graph of the total number of properties for each different risk score for the whole US
#Note risk scores of 1 were left out as they are considered minimal risk

for a,b in all_risks:

    USA = a[scores]
    USA_flood = USA.sum()

    fig1,ax1 = plt.subplots()
    plt.rcParams['figure.dpi'] = 300
    USA_flood.plot.bar(ax=ax1)
    
    ax1.set_xlabel(f'{b} Risk Score')
    ax1.set_ylabel('Number of Properties (Millions)')
    ax1.set_title(f'Total Distribution of {b} Risk in the US')
    
    fig1.savefig(f'{b}_risk_usa.png')

#Creating dataframes for the bottom 20 counties and top 20 counties in terms of risk %
    by_pctrisk = a.sort_values('%_at_risk')

    usa = by_pctrisk
    bottom20 = by_pctrisk[0:20]
    top20 = by_pctrisk[-20:]
    counties = [(bottom20,'20 Lowest Risk'),(top20,'20 Highest Risk'),(usa,'US')]

#Creating graphs for the average number of properties for each different risk score for the bottom and top 20 counties and the whole US
    for c,d in counties:
        mean = c.describe()
        mean = mean.iloc[:,2:11]
        mean = mean.loc['mean']
    
        fig1,ax1 = plt.subplots()
        mean.plot.bar(ax=ax1)
        ax1.set_xlabel(f'{b} Risk Score')
        ax1.set_ylabel('Avg Number of Properties')
        ax1.set_title(f'Avg Distribution of {b} Risk in {d} Counties')
        fig1.savefig(f'{b}_avgrisk_{d.lower()}.png')
        
#Based on the distributions of scores, cutoffs scores for when a property is deemed "at risk" is set at 1 for flood and heat
#This means that at a score of 1 is not considered at risk
#Because there are many properties with a wind and fire score of 2, the cutoff score for wind and fire risk is set at 2 rather than 1